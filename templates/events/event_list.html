{% extends 'events/base.html' %}
{% load tools %}

{% block content %}
{% regroup event_list by start_date|date:"E Y" as month_list %}

<section class="filter">
  <a href="?">Alle</a>
  {% if page.sections.exists %}
  {% for section in page.sections.all %}
  <a href="?section={{section.slug}}">{{section}}</a>
  {% endfor %}
  {% endif %}
</section>

<section class="events">
  {% for month in month_list %}
  <h2>{{month.grouper}}</h2>
  <section class="cards events month">
    {% for event in month.list %}
    <article class="{{event.category.slug}} card horizontal">
      {% if event.image %}
      <a class="image" href="{{event.get_absolute_url}}">
        <img src="{{event.image.url}}" alt="{{event.title}}"/>
      </a>
      {% endif %}
      <div class="content">
        <header class="header"><a href="{{event.get_absolute_url}}">
            {{event.title}}
          </a>
        </header>
        <section>
          <time datetime="{{event.start_date|date:"c"}}">
            {{event.start_date|date:"d.m. H:i"}}
          </time>-<time datetime="{{event.end_date|date:"c"}}">
            {% if event.end_date == event.start_date %}
            {{event.end_date|date:"H:i"}}
            {% else %}
            {{event.end_date|date:"d.m. H:i" }}
            {% endif %}
          </time>
        </section>
      </div>
    </article>
    {% endfor %}
  </section>
  {% endfor %}
</section>
{% include 'includes/pagination.html' with page=event_list%}
<script>
  window.location_list = {{location_list|jsonify}};
  window.event_list = {{event_list|jsonify}};
</script>
{% endblock %}
